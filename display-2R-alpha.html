<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2R Course α 表示</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Noto Sans JP',sans-serif;background:#05060a;color:#e6eef8;height:100vh;display:flex;flex-direction:column}
header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #222}
header .left{display:flex;gap:16px;align-items:center}
header .title{font-weight:900}
header .group{opacity:.8}
header .right{display:flex;gap:12px;align-items:center}
.counter{padding:6px 12px;border-radius:8px;background:#0b1220;border:1px solid #222;font-weight:700}
.status{padding:10px 24px;border-bottom:1px solid #222;display:flex;gap:12px;align-items:center}
.status .ans{color:#ffca28;font-weight:700}
main{flex:1;overflow:hidden;padding:12px}
.players{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
.card{background:#0b1220;border:1px solid #222;border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:6px}
.card.winner{border-color:#c62828}
.card.rest{border-color:#3f51b5}
.name{font-weight:700}
.meta{font-size:12px;color:#9aa4b2}
.center{flex:1;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:900;writing-mode:vertical-rl;text-orientation:upright}
.score{display:flex;gap:8px;justify-content:center}
.score span{padding:4px 8px;border-radius:6px;background:#000}
footer{display:flex;justify-content:space-between;font-size:14px}
</style>
</head>
<body>
<header>
  <div class="left">
    <div class="title">2nd Round : 連答付き5○2×</div>
    <div id="group" class="group">Group-1</div>
  </div>
  <div class="right">
    <div id="count" class="counter">0 >>> 0</div>
  </div>
</header>
<div class="status">
  <div id="qnum">問題 0 / 0</div>
  <div id="qtext"></div>
  <div id="ans" class="ans"></div>
</div>
<main>
  <div id="players" class="players"></div>
</main>
<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js'
import{getDatabase,ref,onValue}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js'
const app=initializeApp({apiKey:"AIzaSyDB_EIa1D49jxMrNVkqJjSrghh6Yp-MLP0",authDomain:"tokiwaji-open-2nd.firebaseapp.com",databaseURL:"https://tokiwaji-open-2nd-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tokiwaji-open-2nd",storageBucket:"tokiwaji-open-2nd.firebasestorage.app",messagingSenderId:"1053108487162",appId:"1:1053108487162:web:1cf8f504522b7e95129a43"})
const db=getDatabase(app)
let participants=[],scores={1:{},2:{}},questions=[],currentGroup=1,qIndex=0
onValue(ref(db,'participants'),s=>{participants=s.exists()?Object.entries(s.val()).map(([id,p])=>({id,...p})).filter(p=>p.course==='α'):[];render()})
onValue(ref(db,'2R/α/group1/scores'),s=>{scores[1]=s.val()||{};render()})
onValue(ref(db,'2R/α/group2/scores'),s=>{scores[2]=s.val()||{};render()})
onValue(ref(db,'2R/α/questions'),s=>{questions=s.exists()?Array.isArray(s.val())?s.val():Object.values(s.val()):[];updateQuestion()})
onValue(ref(db,'2R/α/group1/questionNumber'),s=>{if(currentGroup===1){qIndex=(s.val()||1)-1;updateQuestion()}})
function render(){const box=document.getElementById('players');box.innerHTML='';const ps=participants.filter(p=>p.group===currentGroup);ps.forEach(p=>{const s=scores[currentGroup][p.id]||{correct:0,wrong:0,rest:0};const d=document.createElement('div');d.className='card'+(s.winOrder?' winner':'')+(s.rest>0?' rest':'');d.innerHTML=`<div class="name">${p.name}</div><div class="meta">${p.school||''} ${p.grade||''}</div><div class="center">${p.name}</div><div class="score"><span>○${s.correct||0}</span><span>×${s.wrong||0}</span></div><footer><div>${'⛄'.repeat(s.rest||0)}</div><div>${s.winOrder?'WIN':''}</div></footer>`;box.appendChild(d)});const active=participants.filter(p=>{const s1=scores[1][p.id];const s2=scores[2][p.id];const s=s1||s2||{};return !s.disqualified}).length;const win=Object.values({...scores[1],...scores[2]}).filter(s=>s&&s.winOrder).length;document.getElementById('count').textContent=`${active} >>> ${Math.max(0,5-win)}`}
function updateQuestion(){document.getElementById('qnum').textContent=`問題 ${qIndex+1} / ${questions.length}`;document.getElementById('qtext').textContent=questions[qIndex]?.question||'';document.getElementById('ans').textContent=''}
</script>
</body>
</html>
